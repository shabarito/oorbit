!function(e){function _(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,_),i.loaded=!0,i.exports}var t={};return _.m=e,_.c=t,_.p="",_(0)}([function(e,_){if("undefined"==typeof AFRAME)throw Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("environment",{schema:{active:{default:!1},preset:{default:"default",oneOf:["none","default","contact","egypt","checkerboard","forest","goaland","yavapai","goldmine","arches","threetowers","poison","tron","japan","dream","volcano","starry","osiris"]},seed:{type:"int",default:1,min:0,max:1e3},skyType:{default:"color",oneOf:["none","color","gradient","atmosphere"]},skyColor:{type:"color"},horizonColor:{type:"color"},lighting:{default:"distant",oneOf:["none","distant","point"]},shadow:{default:!1},shadowSize:{default:10},lightPosition:{type:"vec3",default:{x:0,y:1,z:-.2}},fog:{type:"float",default:0,min:0,max:1},flatShading:{default:!1},playArea:{type:"float",default:1,min:.5,max:10},ground:{default:"hills",oneOf:["none","flat","hills","canyon","spikes","noise"]},groundYScale:{type:"float",default:3,min:0,max:50},groundTexture:{default:"none",oneOf:["none","checkerboard","squares","walkernoise"]},groundColor:{type:"color",default:"#553e35"},groundColor2:{type:"color",default:"#694439"},dressing:{default:"none",oneOf:["none","cubes","pyramids","cylinders","hexagons","stones","trees","mushrooms","towers","apparatus","arches","torii"]},dressingAmount:{type:"int",default:10,min:0,max:1e3},dressingColor:{type:"color",default:"#795449"},dressingScale:{type:"float",default:5,min:0,max:100},dressingVariance:{type:"vec3",default:{x:1,y:1,z:1}},dressingUniformScale:{default:!0},dressingOnPlayArea:{type:"float",default:0,min:0,max:1},grid:{default:"none",oneOf:["none","1x1","2x2","crosses","dots","xlines","ylines"]},gridColor:{type:"color",default:"#ccc"},shadowDressing:{default:!1},stageSize:{default:200},groundDetail:{default:64},skyDetail:{default:64},stars:{default:2e3}},multiple:!1,presets:{none:{},default:{active:!0,seed:1,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:-.11,y:1,z:.33},fog:.78,flatShading:!1,playArea:1,ground:"hills",groundYScale:3,groundTexture:"checkerboard",groundColor:"#454545",groundColor2:"#5d5d5d",dressing:"none",dressingAmount:10,dressingColor:"#795449",dressingScale:1,dressingVariance:{x:0,y:0,z:0},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"none",gridColor:"#ccc",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},contact:{active:!0,seed:14,skyType:"gradient",skyColor:"#478d54",horizonColor:"#b696cb",lighting:"distant",lightPosition:{x:0,y:2.01,z:-1},fog:.8,flatShading:!1,playArea:1,ground:"spikes",groundYScale:4.91,groundTexture:"none",groundColor:"#2e455f",groundColor2:"#694439",dressing:"apparatus",dressingAmount:7,dressingColor:"#657067",dressingScale:20,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"1x1",gridColor:"#478d54",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},egypt:{active:!0,seed:26,skyType:"gradient",skyColor:"#1b7660",horizonColor:"#e4b676",lighting:"distant",lightPosition:{x:0,y:1.65,z:-1},fog:.75,flatShading:!1,playArea:1,ground:"hills",groundYScale:5,groundTexture:"walkernoise",groundColor:"#664735",groundColor2:"#6c4b39",dressing:"pyramids",dressingAmount:10,dressingColor:"#7c5c45",dressingScale:5,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"spots",gridColor:"#e4b676",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},checkerboard:{active:!0,seed:1,skyType:"gradient",skyColor:"#0d0d0d",horizonColor:"#404040",lighting:"distant",lightPosition:{x:0,y:1,z:-.2},fog:.81,flatShading:!0,playArea:1,ground:"hills",groundYScale:4.81,groundTexture:"checkerboard",groundColor:"#252525",groundColor2:"#111111",dressing:"cubes",dressingAmount:10,dressingColor:"#9f9f9f",dressingScale:1.51,dressingVariance:{x:5,y:20,z:5},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"dots",gridColor:"#ccc",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},forest:{active:!0,seed:8,skyType:"gradient",skyColor:"#24b59f",horizonColor:"#eff9b7",lighting:"distant",lightPosition:{x:-1.2,y:.88,z:-.55},fog:.8,flatShading:!1,playArea:1,ground:"noise",groundYScale:4.18,groundTexture:"squares",groundColor:"#937a24",groundColor2:"#987d2e",dressing:"trees",dressingAmount:500,dressingColor:"#888b1d",dressingScale:1,dressingVariance:{x:10,y:10,z:10},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"none",gridColor:"#c5a543",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},goaland:{active:!0,seed:17,skyType:"gradient",skyColor:"#14645f",horizonColor:"#a3dab8",lighting:"point",lightPosition:{x:.1,y:4,z:.56},fog:.73,flatShading:!1,playArea:1,ground:"noise",groundYScale:.81,groundTexture:"none",groundColor:"#ae3241",groundColor2:"#db4453",dressing:"mushrooms",dressingAmount:150,dressingColor:"#a9313d",dressingScale:5,dressingVariance:{x:5,y:10,z:5},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"dots",gridColor:"#239893",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},yavapai:{active:!0,seed:11,skyType:"gradient",skyColor:"#239849",horizonColor:"#cfe0af",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!0,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#C66344",groundColor2:"#c96b4b",dressing:"stones",dressingAmount:500,dressingColor:"#C66344",dressingScale:.06,dressingVariance:{x:.2,y:.1,z:.2},dressingUniformScale:!0,dressingOnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},goldmine:{active:!0,seed:53,skyType:"gradient",skyColor:"#1e1c1a",horizonColor:"#8c7964",lighting:"point",lightPosition:{x:-.09,y:3,z:.33},fog:.43,flatShading:!0,playArea:1.08,ground:"canyon",groundYScale:50,groundTexture:"none",groundColor:"#353535",groundColor2:"#454545",dressing:"hexagons",dressingAmount:300,dressingColor:"#fe921b",dressingScale:.5,dressingVariance:{x:2,y:8,z:2},dressingUniformScale:!0,dressingOnPlayArea:.03,grid:"none",gridColor:"#ccc",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},threetowers:{active:!0,seed:5,skyType:"gradient",skyColor:"#23a06b",horizonColor:"#f5e170",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!1,playArea:1,ground:"spikes",groundYScale:4.26,groundTexture:"walkernoise",groundColor:"#273a49",groundColor2:"#2b464f",dressing:"towers",dressingAmount:3,dressingColor:"#5f6d94",dressingScale:50,dressingVariance:{x:10,y:100,z:10},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"none",gridColor:"#239893",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},poison:{active:!0,seed:92,skyType:"gradient",skyColor:"#1ea84a",horizonColor:"#177132",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!1,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"none",groundColor:"#851f31",groundColor2:"#912235",dressing:"hexagons",dressingAmount:20,dressingColor:"#c7415b",dressingScale:20,dressingVariance:{x:20,y:200,z:20},dressingUniformScale:!1,dressingOnPlayArea:0,grid:"crosses",gridColor:"#1ea84a",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},arches:{active:!0,seed:19,skyType:"atmosphere",skyColor:"#8cbdc8",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:-.11,y:.16,z:.33},fog:.67,flatShading:!0,playArea:1,ground:"canyon",groundYScale:10,groundTexture:"walkernoise",groundColor:"#a87d6f",groundColor2:"#795449",dressing:"arches",dressingAmount:6,dressingColor:"#795449",dressingScale:26,dressingVariance:{x:20,y:40,z:20},dressingUniformScale:!0,dressingOnPlayArea:.04,grid:"none",gridColor:"#ccc",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},tron:{active:!0,seed:14,skyType:"gradient",skyColor:"#091b39",horizonColor:"#284a9e",lighting:"distant",lightPosition:{x:-.72,y:.62,z:.4},fog:.8,flatShading:!1,playArea:1,ground:"spikes",groundYScale:4.91,groundTexture:"none",groundColor:"#061123",groundColor2:"#694439",dressing:"towers",dressingAmount:5,dressingColor:"#fb000e",dressingScale:15,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"1x1",gridColor:"#fb000e",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},japan:{active:!0,seed:14,skyType:"gradient",skyColor:"#7e5db5",horizonColor:"#b4adda",lighting:"distant",lightPosition:{x:1.33,y:1,z:.24},fog:.9,flatShading:!1,playArea:1,ground:"hills",groundYScale:25,groundTexture:"walkernoise",groundColor:"#7e5db5",groundColor2:"#cabdf5",dressing:"torii",dressingAmount:4,dressingColor:"#bc5e7c",dressingScale:15,dressingVariance:{x:0,y:0,z:0},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"spots",gridColor:"#e4b676",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},dream:{active:!0,seed:17,skyType:"gradient",skyColor:"#87faf4",horizonColor:"#b34093",lighting:"distant",lightPosition:{x:-.72,y:.53,z:.97},fog:.8,flatShading:!1,playArea:1,ground:"hills",groundYScale:20,groundTexture:"checkerboard",groundColor:"#b34093",groundColor2:"#c050a2",dressing:"mushrooms",dressingAmount:300,dressingColor:"#3cf7ed",dressingScale:.2,dressingVariance:{x:.2,y:.2,z:.2},dressingUniformScale:!0,dressingOnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},volcano:{active:!0,seed:92,skyType:"gradient",skyColor:"#4a070f",horizonColor:"#f62300",lighting:"point",lightPosition:{x:.5,y:2.25,z:0},fog:.87,flatShading:!1,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#fb0803",groundColor2:"#510000",dressing:"arches",dressingAmount:15,dressingColor:"#fb0803",dressingScale:3,dressingVariance:{x:10,y:100,z:10},dressingUniformScale:!1,dressingOnPlayArea:.2,grid:"none",gridColor:"#fa0e00",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},starry:{active:!0,seed:1,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:0,y:-.01,z:-.46},fog:.7,flatShading:!1,playArea:1,ground:"hills",groundYScale:3,groundTexture:"none",groundColor:"#553e35",groundColor2:"#694439",dressing:"none",dressingAmount:100,dressingColor:"#795449",dressingScale:5,dressingVariance:{x:1,y:1,z:1},dressingUniformScale:!0,grid:"1x1",dressingOnPlayArea:0,gridColor:"#39d2f2",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},osiris:{active:!0,seed:46,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:0,y:.02,z:-.46},fog:0,flatShading:!1,playArea:1,ground:"hills",groundYScale:3,groundTexture:"none",groundColor:"#9e7b47",groundColor2:"#9e7b47",dressing:"pyramids",dressingAmount:7,dressingColor:"#9e7b47",dressingScale:5,dressingVariance:{x:30,y:30,z:30},dressingUniformScale:!0,grid:"dots",dressingOnPlayArea:0,gridColor:"#daa452",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3},moon:{active:!0,seed:11,skyType:"gradient",skyColor:"#000000",horizonColor:"#000000",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!0,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#D1D1D1",groundColor2:"#494949",dressing:"stones",dressingAmount:500,dressingColor:"#494949",dressingScale:.06,dressingVariance:{x:.2,y:.1,z:.2},dressingUniformScale:!0,dressingOnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1,shadowDressing:!1,stageSize:200,groundDetail:64,skyDetail:64,stars:2e3}},init:function(){for(var e in this.environmentData={},this.STAGE_SIZE=this.data.stageSize,this.assets={arches:[{type:"mesh",vertices:[409,268,4,351,228,36,336,236,-57,-152,391,69,-135,358,88,-119,330,43,-20,358,-35,-153,357,-47,37,413,-26,-20,411,-14,-302,148,154,-339,121,-126,-389,200,-88,-477,193,-76,-314,346,-19,-314,306,-30,-250,296,-73,-267,237,-82,-212,303,-68,-245,200,-67,-223,304,108,-329,299,107,-289,350,76,-320,342,69,119,373,-39,38,370,8,113,367,52,492,202,-31,462,83,-104,447,71,-80,426,112,25,482,189,-7,222,372,6,121,402,41,87,382,67,221,346,55,559,93,-13,528,47,39,505,21,-111,528,54,-101,616,31,-53,442,256,-15,300,338,19,257,308,-79,408,256,-74,312,352,-26,384,297,-31,437,257,-47,-29,415,53,-232,377,59,-139,335,77,-132,344,2,-18,377,-37,-171,387,-28,-254,384,18,-651,-27,27,-435,-28,179,-345,149,165,-272,-28,23,-215,146,-2,-279,-29,-59,-211,145,-55,-337,-28,-128,-413,247,0,-293,363,24,-214,254,-36,-164,290,33,-284,150,94,-218,362,105,75,369,29,518,147,-63,447,190,-70,445,56,-105,391,185,-60,431,49,-33,459,83,26,470,162,42,130,390,53,167,341,-30,125,394,-45,239,368,-17,91,414,10,450,18,2,449,-27,-9,436,-28,-58,496,-27,-110,582,-28,-140,647,-27,-56,325,325,-45,-307,297,-56,-647,-28,-45,-188,310,-54,-264,197,113,-367,175,139,8,387,82,426,45,-55,114,359,-28,500,27,44,461,-29,13,-512,-27,-151,-152,376,-38,-490,-28,148,12,370,-28,442,160,42,465,194,32,381,183,-33,649,-27,-34,444,16,29,616,-28,25,417,267,-66,-132,352,-34,-322,-27,130,-271,86,-115,-635,-28,-121,-291,203,-99,176,405,-10,561,52,-93,371,305,9,311,237,-22,377,200,-81,-129,406,46,-154,371,99,-82,361,71,-21,354,26,-91,363,-27,-165,413,-12,-414,215,110,-238,127,26,-408,-28,-128,-674,-28,-94,-446,232,-39,-311,226,-90,-255,210,-61,-235,192,-11,-217,218,58,-269,299,124,-386,276,78,-399,281,42,15,373,58,16,393,75,549,107,-46,481,188,-68,409,120,-41,541,81,12,230,368,41,194,350,-50,224,361,-50,604,-28,-10,602,-27,35,486,56,-121,502,69,-120,457,-27,-110,226,317,-40,-584,-28,-124,439,-26,-30,467,-26,39,547,-27,-146,21,368,14,466,229,-29,578,-27,44,609,-27,-96,291,356,-15,290,306,34,255,321,28,231,311,-5,-251,386,50,-183,307,87,-152,307,24,-264,373,-12,-392,-27,190,-333,-28,84,-281,-27,54,-270,-28,-23,-308,-28,-101,-687,-27,-59,39,418,39,413,163,25,404,206,-90,54,400,-31,121,352,8,-454,41,148,-426,9,182,-564,115,3,-427,27,-107,-548,118,-32,-556,122,-53,-517,91,-101,-475,54,140,-461,52,-134,-558,119,-71,-434,286,59,-687,-31,52,-595,146,22,-670,-28,164,-537,166,122,-575,-28,217,-566,159,65,-470,152,136,-712,-29,102,-639,-29,211,-532,-30,181,-442,-30,-100],faces:[76,104,162,1,176,103,103,76,1,2,119,73,73,105,2,2,118,152,45,161,46,46,109,45,3,120,49,49,68,3,3,121,139,139,48,3,4,122,94,94,121,4,6,123,124,9,175,81,10,169,111,10,67,92,88,43,146,11,131,114,11,128,183,13,130,15,90,184,174,90,182,184,130,184,63,14,130,63,15,130,14,16,131,12,15,168,53,18,91,17,131,16,17,65,133,132,65,132,91,67,134,166,166,92,67,20,135,92,20,166,4,4,121,20,22,135,68,25,102,96,25,157,102,69,138,157,69,157,25,39,150,71,71,141,39,28,150,149,149,72,28,142,176,105,36,140,27,27,143,36,32,115,81,32,144,161,161,80,32,77,35,144,34,26,77,78,179,96,145,152,78,178,79,145,80,146,79,147,140,36,143,108,36,143,37,148,74,95,154,154,83,74,72,149,151,151,95,72,38,150,156,40,147,106,70,140,40,40,116,70,42,162,0,35,163,162,43,145,146,46,117,41,47,158,27,48,139,175,122,138,94,157,138,123,52,178,102,52,102,6,52,124,7,7,100,52,53,125,8,57,93,181,56,169,181,59,127,58,60,173,61,62,128,11,11,112,62,65,91,167,65,167,66,126,93,21,22,68,49,72,95,29,142,29,74,74,82,142,75,107,97,75,97,103,76,97,37,104,143,31,78,152,164,78,164,179,79,178,8,97,155,159,107,98,155,83,98,82,154,95,84,39,116,86,86,156,39,87,160,116,24,145,96,162,104,0,105,118,2,43,177,119,44,177,43,91,51,167,44,88,109,46,161,117,3,68,121,3,48,120,4,166,50,50,122,4,5,123,122,123,138,122,110,124,51,170,10,111,110,91,7,7,124,110,8,125,9,9,81,8,186,12,188,92,135,10,11,114,112,64,63,137,13,15,89,89,53,100,64,168,14,14,168,15,89,100,16,16,12,89,100,18,16,17,91,132,112,19,61,18,7,91,19,17,132,133,127,59,133,59,61,136,21,22,134,127,133,20,92,166,121,135,20,158,31,27,21,135,22,23,137,136,24,102,178,178,145,24,25,179,69,26,94,138,27,140,70,27,70,141,150,177,71,28,177,150,29,142,73,73,119,29,142,82,30,30,176,142,107,75,82,31,143,27,33,81,175,31,41,104,115,79,8,32,33,144,80,115,32,33,175,139,35,162,42,77,139,34,163,26,179,163,179,164,78,96,145,177,29,119,108,143,148,148,37,159,97,159,37,74,83,82,38,149,150,156,150,39,40,106,87,87,116,40,140,147,40,161,144,42,42,117,161,41,0,104,41,117,0,0,117,42,164,118,163,1,163,118,118,176,1,118,105,176,152,118,164,43,152,145,43,119,2,71,109,141,47,41,158,44,71,177,45,109,88,45,88,146,46,47,109,141,47,27,167,50,166,49,120,165,139,121,94,5,122,50,123,51,124,157,6,102,157,123,6,100,8,178,5,167,51,6,124,52,100,178,52,53,168,125,125,165,120,54,125,168,9,48,175,120,9,125,93,10,135,181,101,56,57,169,10,59,172,61,67,170,171,67,171,127,58,127,171,129,186,113,60,61,172,61,173,112,62,112,173,174,189,129,165,64,23,64,137,23,165,22,49,64,54,168,17,114,131,17,112,114,66,133,65,19,132,133,19,133,61,134,133,66,166,134,66,166,66,167,93,135,21,68,135,121,23,136,22,94,34,139,25,96,179,26,138,69,69,179,26,30,103,176,116,141,70,39,141,116,73,142,105,143,76,37,26,35,77,103,97,76,77,144,33,33,139,77,38,151,149,80,161,45,80,45,146,81,115,8,107,155,97,82,98,107,95,151,84,38,156,85,86,116,160,96,102,24,72,29,28,29,95,74,75,30,82,108,147,36,88,44,43,91,110,51,170,67,10,11,183,131,64,14,63,89,15,53,100,7,18,112,17,19,127,134,67,136,126,21,158,41,31,33,32,81,115,80,79,177,28,29,43,2,152,71,44,109,47,46,41,141,109,47,167,5,50,123,5,51,100,53,8,125,54,165,9,120,48,93,57,10,59,58,172,174,185,189,165,54,64,165,23,22,94,26,34,30,75,103,143,104,76,26,163,35,38,85,151,192,182,191,183,128,201,12,13,89,181,169,57,186,153,113,188,183,99,184,182,63,185,13,189,180,181,93,186,99,153,189,186,129,185,184,130,186,13,12,187,93,126,193,199,194,194,196,193,200,187,195,187,197,195,187,126,197,197,190,194,190,136,137,190,196,194,63,182,192,63,192,196,192,198,196,191,182,55,193,196,198,194,199,197,195,197,199,136,197,126,190,137,63,190,63,196,197,136,190,192,191,198,201,99,183,90,55,182,181,180,101,185,130,13,186,188,99,186,189,13,187,180,93,200,101,187,183,188,131,184,185,174,180,187,101,16,18,17,12,131,188,35,42,144,163,1,162,76,162,1,79,146,145]}],stones:[{type:"mesh",vertices:[-376,189,42,230,223,-310,353,162,-62,414,-23,-67,256,90,-475,24,85,-526,-418,-16,57,-432,66,-40,-199,151,-376,-155,49,467,-91,289,201,293,197,91,81,-17,-480,42,108,431,-359,-17,-250,383,-19,-243,194,-15,270,-272,180,293,-86,212,262,234,54,297,395,97,-302,-123,-21,-444,-416,-19,-123,-323,-18,267,-100,-16,429,-300,96,-361,163,-19,409,118,201,-431,-241,-18,391,-130,274,-309,306,-19,-399,-221,96,404],faces:[31,18,17,0,17,18,3,20,2,18,11,10,29,27,8,27,29,1,0,18,10,10,29,0,16,19,26,11,2,1,20,30,4,20,3,15,30,12,4,4,12,5,5,27,4,4,27,20,21,25,5,7,8,25,22,7,14,7,25,14,23,28,31,0,7,17,24,26,9,31,28,9,8,27,5,2,20,1,13,19,18,10,11,1,19,13,26,3,11,19,19,16,3,11,3,2,11,18,19,20,15,30,29,10,1,25,21,14,8,5,25,5,12,21,6,7,22,7,6,23,8,0,29,8,7,0,23,31,7,13,31,9,18,31,13,9,28,24,26,13,9,27,1,20,7,31,17]},{type:"mesh",vertices:[-217,34,-153,198,90,20,212,85,169,-131,93,171,197,113,30,173,121,164,315,29,-16,219,24,189,282,50,-102,232,38,-181,-195,-9,-166,-156,30,-207,-51,-9,-231,-180,91,-173,-19,73,-204,-280,23,96,-242,100,107,3,158,-82,109,88,221,275,-10,-40,236,-10,-135,-178,49,184,-1,-10,-243,265,-11,109,-12,-9,237,-36,46,251,-233,86,-81,93,77,-171,-163,133,69,18,16,263,296,44,93,131,-12,-226,-89,-10,-201,-273,-10,-51,-240,-9,110,190,-12,192,-253,-11,-92,42,43,-258,-115,-11,238,168,99,-88,-285,-10,24,71,124,-158,298,-10,10,116,150,-24,-282,44,39],faces:[44,16,26,13,26,16,0,26,13,27,14,41,4,5,1,7,30,2,28,5,43,41,39,27,17,43,41,43,4,39,13,28,17,17,41,13,28,43,17,24,29,38,29,35,7,18,25,29,5,18,2,18,5,3,30,42,6,30,35,23,19,20,8,8,20,9,9,39,8,1,30,8,31,37,9,11,14,37,14,27,37,32,11,12,11,37,12,11,0,13,33,40,44,44,26,33,33,0,36,34,38,15,44,40,15,21,3,16,27,39,9,2,30,1,21,25,3,16,3,28,28,3,5,4,43,5,41,43,39,13,16,28,25,21,38,38,29,25,7,18,29,29,24,35,18,7,2,18,3,25,30,23,42,30,7,35,8,30,6,6,19,8,6,42,19,8,39,1,37,31,22,27,9,37,9,20,31,10,11,32,11,10,0,12,37,22,14,13,41,14,11,13,33,26,0,36,0,10,21,44,15,16,44,21,15,40,34,38,21,15,4,1,39,5,2,1]},{type:"mesh",vertices:[-101,102,57,99,35,102,40,72,80,59,14,-168,-186,22,45,-176,25,-30,66,-7,146,153,-7,53,-110,47,-96,-90,-8,-146,150,-7,-12,-200,-7,8,-173,-7,-55,55,46,-60,125,-7,110,136,30,-10,-149,58,68,-15,82,-71,98,-7,-86,-34,-6,-194,-33,-7,171,-36,65,137,38,-8,-192,-103,-9,147,-12,62,-152],faces:[2,17,0,17,8,0,17,24,8,19,24,22,5,11,4,2,13,17,17,13,24,21,23,20,1,2,21,7,15,1,7,10,15,5,9,12,15,18,13,0,5,16,0,8,5,1,15,2,10,18,15,3,13,18,24,3,22,11,23,4,4,16,5,16,4,23,24,13,3,15,13,2,6,1,21,6,21,20,6,14,1,2,0,21,1,14,7,3,18,22,8,24,19,8,19,9,12,11,5,5,8,9,16,23,21,16,21,0]},{type:"mesh",vertices:[86,55,-18,58,38,73,97,-12,79,135,7,10,-93,-11,-72,-133,5,33,13,68,-32,94,-11,-57,-90,52,53,-24,-11,-106,-13,-10,104,-75,49,-69,-12,18,114,49,-12,-96,-46,-11,-85,-119,-11,-26,48,5,-111,-58,-11,105,-117,-12,52,-5,35,-93,123,-11,7],faces:[5,8,11,2,3,1,8,1,6,11,8,6,6,19,11,10,12,17,20,7,3,3,7,16,16,0,3,16,9,19,14,4,9,15,18,5,5,11,15,18,17,5,19,0,16,1,3,0,0,6,1,19,6,0,12,8,17,2,1,12,12,10,2,1,8,12,3,2,20,16,13,9,16,7,13,19,4,11,15,11,4,17,8,5,9,4,19]}],torii:[{type:"mesh",mirror:!0,flatShading:!0,vertices:[692,966,-52,661,834,-52,692,966,52,661,834,52,0,894,-52,0,776,-52,0,894,52,0,776,52,518,935,52,345,913,52,170,899,52,162,779,52,328,790,52,494,808,52,170,899,-52,345,913,-52,518,935,-52,494,808,-52,328,790,-52,162,779,-52,0,618,16,0,697,16,0,618,-16,0,697,-16,586,618,16,586,697,16,586,618,-16,586,697,-16,331,-29,-75,331,766,-52,369,-29,-65,357,766,-45,396,-29,-37,377,766,-26,406,-29,0,384,766,0,396,-29,37,377,766,26,369,-29,65,357,766,45,331,-29,75,331,766,52,294,-29,65,305,766,45,267,-29,37,286,766,26,257,-29,0,279,766,0,267,-29,-37,286,766,-26,294,-29,-65,305,766,-45,0,777,85,0,681,33,333,762,-75,333,806,-75,371,762,-65,371,806,-65,398,762,-37,398,806,-37,408,762,0,408,806,0,398,762,37,398,806,37,371,762,65,371,806,65,333,762,75,333,806,75,296,762,65,296,806,65,268,762,37,268,806,37,258,762,0,258,806,0,268,762,-37,268,806,-37,296,762,-65,296,806,-65,0,681,-33,0,777,-85,52,681,33,52,777,85,52,681,-33,52,777,-85],faces:[4,10,14,1,13,17,11,6,7,0,3,1,16,1,17,4,19,5,14,18,19,15,17,18,3,8,13,13,9,12,12,10,11,19,7,5,19,12,11,18,13,12,16,2,0,15,8,16,14,9,15,23,26,22,27,24,26,25,20,24,26,20,22,23,25,27,29,30,28,31,32,30,33,34,32,35,36,34,37,38,36,39,40,38,41,42,40,43,44,42,45,46,44,47,48,46,49,50,48,51,28,50,55,56,54,57,58,56,59,60,58,61,62,60,63,64,62,79,81,83,65,66,64,82,53,78,67,68,66,81,53,80,69,70,68,83,80,82,71,72,70,79,82,78,73,74,72,75,63,59,75,76,74,77,54,76,60,68,76,4,6,10,1,3,13,11,10,6,0,2,3,16,0,1,4,14,19,14,15,18,15,16,17,3,2,8,13,8,9,12,9,10,19,11,7,19,18,12,18,17,13,16,8,2,15,9,8,14,10,9,23,27,26,27,25,24,25,21,20,26,24,20,23,21,25,29,31,30,31,33,32,33,35,34,35,37,36,37,39,38,39,41,40,41,43,42,43,45,44,45,47,46,47,49,48,49,51,50,51,29,28,55,57,56,57,59,58,59,61,60,61,63,62,63,65,64,79,52,81,65,67,66,82,80,53,67,69,68,81,52,53,69,71,70,83,81,80,71,73,72,79,83,82,73,75,74,59,57,55,55,77,75,75,73,71,71,69,75,67,65,63,63,61,59,59,55,75,75,69,67,67,63,75,75,77,76,77,55,54,76,54,56,56,58,76,60,62,68,64,66,68,68,70,72,72,74,68,76,58,60,62,64,68,68,74,76]}],hexagons:[{type:"extrude",vertices:[-.198,-.302,.197,-.3,.372,0,.199,.298,-.202,.298,-.368,0]}],towers:[{type:"extrude",vertices:[-.054,-.178,-.007,-.182,.069,-.027,.189,.079,.178,.124,-.007,.097,-.145,.182,-.178,.144,-.079,-.021]},{type:"lathe",segments:4,vertices:[.004,.02,.012,.092,.042,.166,.067,.55,.101,.594,.105,.838,.193,.934,.18,.994]},{type:"lathe",segments:5,vertices:[.069,.216,.067,.562,.126,.562,.128,.774,.191,.774,.193,.986]}],trees:[{type:"lathe",noise:.015,segments:6,vertices:[1e-6,.826,.054,.832,.105,.854,.136,.9,.136,.958,.118,.994]},{type:"lathe",noise:.015,segments:14,vertices:[1e-6,.01,.069,.022,.13,.068,.178,.18,.189,.32,.191,.59,.193,.75,.138,.79,.018,.808,.018,.996]},{type:"lathe",noise:.015,segments:14,vertices:[1e-6,.436,.126,.46,.201,.57,.219,.72,.154,.846,.028,.884,.034,.996]}],apparatus:[{type:"lathe",segments:10,vertices:[1e-6,.23,.042,.23,.069,.36,.038,.362,.038,.372,.06,.372,.073,.572,.024,.572,.024,.67,.069,.67,.075,.722,.097,.724,.105,.852,.083,.902,.065,.902,.065,.924,.128,.924,.146,.996]},{type:"lathe",segments:16,vertices:[1e-6,.232,.229,.182,.486,.07,.356,.182,.213,.242,.154,.242,.144,.262,.178,.262,.126,.314,.04,.328,.038,.374,.058,.374,.071,.408,.026,.406,.03,.42,.091,.418,.034,.496,.01,.498,.03,.506,.014,.998]}],mushrooms:[{type:"lathe",noise:.02,segments:14,vertices:[1e-6,.006,.13,.018,.341,.084,.437,.144,.492,.234,.484,.246,.276,.232,.107,.284,.046,.346,.062,.852,.097,.956,.166,.998]},{type:"lathe",noise:.02,segments:10,vertices:[1e-6,.562,.091,.572,.172,.61,.223,.666,.256,.74,.258,.806,.246,.824,.062,.826,.065,.948,.097,.998]},{type:"lathe",noise:.02,segments:10,vertices:[1e-6,.768,.099,.772,.219,.802,.306,.844,.352,.886,.352,.908,.118,.904,.107,.93,.115,.966,.14,.996]}]},this.assets)for(var _=0;_<this.assets[e].length;_++){var t=this.assets[e][_];if("mesh"==t.type)for(var n=0,i=t.vertices.length;n<i;n++)t.vertices[n]/=1e3}this.userFog=this.el.sceneEl.getAttribute("fog"),this.sky=document.createElement("a-sky"),this.sky.setAttribute("radius",this.STAGE_SIZE),this.sky.setAttribute("theta-length",110),this.sky.setAttribute("segments-width",this.data.skyDetail),this.sky.setAttribute("segments-height",this.data.skyDetail/2),this.sky.classList.add("environment"),this.stars=null,this.groundMaterial=null,this.ground=document.createElement("a-entity"),this.ground.setAttribute("rotation","-90 0 0"),this.ground.classList.add("environmentGround"),this.ground.classList.add("environment"),this.groundCanvas=null,this.groundTexture=null,this.groundMaterial=null,this.groundGeometry=null,this.dressing=document.createElement("a-entity"),this.dressing.classList.add("environmentDressing"),this.dressing.classList.add("environment"),this.gridCanvas=null,this.gridTexture=null,this.hemilight=document.createElement("a-entity"),this.hemilight.classList.add("environment"),this.hemilight.setAttribute("position","0 50 0"),this.hemilight.setAttribute("light",{type:"hemisphere",color:"#CEE4F0",intensity:.4}),this.sunlight=document.createElement("a-entity"),this.sunlight.classList.add("environment"),this.sunlight.setAttribute("position",this.data.lightPosition),this.sunlight.setAttribute("light",{intensity:.6}),this.el.appendChild(this.hemilight),this.el.appendChild(this.sunlight),this.el.appendChild(this.ground),this.el.appendChild(this.dressing),this.el.appendChild(this.sky)},getFogColor:function(e,_){var t;if("color"==e||"none"==e)t=new THREE.Color(this.environmentData.skyColor);else if("gradient"==e)t=new THREE.Color(this.environmentData.horizonColor);else if("atmosphere"==e){var n=[1,.5,.22,.1,.05,0],i=["#C0CDCF","#81ADC5","#525e62","#2a2d2d","#141616","#000"];if(_<=0)return"#000";_=Math.min(1,_);for(var r=0;r<n.length;r++)if(_>n[r]){var o=new THREE.Color(i[r-1]),s=new THREE.Color(i[r]),a=(_-n[r])/(n[r-1]-n[r]);s.lerp(o,a),t=s;break}}return t.multiplyScalar(.9),t.lerp(new THREE.Color(this.data.groundColor),.3),"#"+t.getHexString()},update:function(e){this.data.preset?(_=AFRAME.utils.clone(this.environmentData),this.environmentData={},Object.assign(this.environmentData,this.data),Object.assign(this.environmentData,this.presets[this.data.preset]),Object.assign(this.environmentData,this.el.components.environment.attrValue)):(_=e,this.environmentData=this.data);var _,t=this.environmentData.skyType,n=new THREE.Vector3(this.environmentData.lightPosition.x,this.environmentData.lightPosition.y,this.environmentData.lightPosition.z);if(n.normalize(),this.sunlight){if(this.sunlight.setAttribute("position",this.environmentData.lightPosition),"atmosphere"!=t){var i=new THREE.Color(this.environmentData.skyColor);i.r=(i.r+1)/2,i.g=(i.g+1)/2,i.b=(i.b+1)/2,this.hemilight.setAttribute("light",{color:"#"+i.getHexString()}),this.sunlight.setAttribute("light",{intensity:.6}),this.hemilight.setAttribute("light",{intensity:.6})}else this.sunlight.setAttribute("light",{intensity:.1+.5*n.y*(n.y<0)?0:1}),this.hemilight.setAttribute("light",{intensity:.1+.5*n.y*(n.y<0)?0:1});this.sunlight.setAttribute("light",{castShadow:this.environmentData.shadow,shadowCameraLeft:-this.environmentData.shadowSize,shadowCameraBottom:-this.environmentData.shadowSize,shadowCameraRight:this.environmentData.shadowSize,shadowCameraTop:this.environmentData.shadowSize})}if(t!==_.skyType||this.environmentData.skyColor!=_.skyColor||this.environmentData.horizonColor!=_.horizonColor){var r={};r.shader=({none:"flat",color:"flat",gradient:"gradientshader",atmosphere:"skyshader"})[t],this.stars&&this.stars.setAttribute("visible","atmosphere"==t),"color"==t?(r.color=this.environmentData.skyColor,r.fog=!1):"gradient"==t&&(r.topColor=this.environmentData.skyColor,r.bottomColor=this.environmentData.horizonColor),this.sky.setAttribute("material",r)}"atmosphere"==t&&(this.sky.setAttribute("material",{sunPosition:n}),this.setStars(this.environmentData.stars*(1-Math.max(0,8*(n.y+.08))))),this.environmentData.fog>0?this.el.sceneEl.setAttribute("fog",{color:this.getFogColor(t,n.y),far:(1.01-this.environmentData.fog)*this.STAGE_SIZE*2}):this.el.sceneEl.removeAttribute("fog"),this.sunlight.setAttribute("light",{type:"point"==this.environmentData.lighting?"point":"directional"}),this.sunlight.setAttribute("visible","none"!==this.environmentData.lighting),this.hemilight.setAttribute("visible","none"!==this.environmentData.lighting);var o=!this.groundGeometry||this.environmentData.seed!=_.seed||this.environmentData.ground!=_.ground||this.environmentData.playArea!=_.playArea||this.environmentData.flatShading!=_.flatShading;(o||this.environmentData.groundColor!=_.groundColor||this.environmentData.groundColor2!=_.groundColor2||this.environmentData.groundYScale!=_.groundYScale||this.environmentData.groundTexture!=_.groundTexture||this.environmentData.gridColor!=_.gridColor||this.environmentData.grid!=_.grid)&&(this.updateGround(o),this.hemilight&&this.hemilight.setAttribute("light",{groundColor:this.environmentData.groundColor})),this.environmentData.seed==_.seed&&this.environmentData.dressingOnPlayArea==_.dressingOnPlayArea&&this.environmentData.dressing==_.dressing&&this.environmentData.flatShading==_.flatShading&&this.environmentData.dressingAmount==_.dressingAmount&&this.environmentData.dressingScale==_.dressingScale&&this.environmentData.dressingColor==_.dressingColor&&this.environmentData.dressingVariance.x==_.dressingVariance.x&&this.environmentData.dressingVariance.y==_.dressingVariance.y&&this.environmentData.dressingVariance.z==_.dressingVariance.z&&this.environmentData.dressingUniformScale==_.dressingUniformScale||this.updateDressing(),this.sky.setAttribute("visible","none"!==t),this.el.setAttribute("visible",this.environmentData.active),this.environmentData.active||(this.userFog?this.el.sceneEl.setAttribute("fog",this.userFog):this.el.sceneEl.removeAttribute("fog"))},logPreset:function(){},dumpParametersDiff:function(){},random:function(e){return parseFloat("0."+Math.sin(9999*this.environmentData.seed*e).toString().substr(7))},updateGround:function(e){var _=this.environmentData.groundDetail;if(e){var n="none"!=this.environmentData.ground;if(this.ground.setAttribute("visible",n),!n)return;this.groundGeometry||(this.groundGeometry=new THREE.PlaneGeometry(this.STAGE_SIZE+2,this.STAGE_SIZE+2,_-1,_-1));for(var i=new t(this.environmentData.seed),r=this.groundGeometry.attributes.position.array,o=r.length,s=10/_,a=0,$=0,l=2;l<o;l+=3)if("flat"!=this.environmentData.ground){switch(this.environmentData.ground){case"hills":d=Math.max(0,i.noise(a,$,0));break;case"canyon":d=Math.min(1,10*Math.pow(d=.2+.8*i.noise(a,$,0),2));break;case"spikes":d=.02>this.random(l)?this.random(l+1):0;break;case"noise":d=.35>this.random(l)?this.random(l+1):0}d+=.1*this.random(l+2);var d,g=2*a/10-1,h=2*$/10-1,u=this.environmentData.playArea;(d*=(g=Math.max(0,Math.min(1,(Math.abs(g)-(u-.9))*(1/u))))>(h=Math.max(0,Math.min(1,(Math.abs(h)-(u-.9))*(1/u))))?g:h)<.01&&(d=0),r[l]=d,(a+=s)>=10&&(a=0,$+=s)}else r[l]=0;this.groundGeometry.computeVertexNormals(),this.groundGeometry.attributes.position.needsUpdate=!0,this.groundGeometry.attributes.normal.needsUpdate=!0}this.ground.setAttribute("scale",{z:this.environmentData.groundYScale});var c=this.STAGE_SIZE/20;this.groundCanvas&&2048==this.groundCanvas.width||(this.gridCanvas=document.createElement("canvas"),this.gridCanvas.width=2048,this.gridCanvas.height=2048,this.gridTexture=new THREE.Texture(this.gridCanvas),this.gridTexture.wrapS=THREE.RepeatWrapping,this.gridTexture.wrapT=THREE.RepeatWrapping,this.gridTexture.repeat.set(c,c),this.groundCanvas=document.createElement("canvas"),this.groundCanvas.width=2048,this.groundCanvas.height=2048,this.groundTexture=new THREE.Texture(this.groundCanvas),this.groundTexture.wrapS=THREE.RepeatWrapping,this.groundTexture.wrapT=THREE.RepeatWrapping,this.groundTexture.repeat.set(c,c),this.groundMaterialProps={map:this.groundTexture,emissive:new THREE.Color(16777215),emissiveMap:this.gridTexture},(new THREE.Material).hasOwnProperty("shading")?this.groundMaterialProps.shading=this.environmentData.flatShading?THREE.FlatShading:THREE.SmoothShading:this.groundMaterialProps.flatShading=this.environmentData.flatShading,this.groundMaterial=new THREE.MeshLambertMaterial(this.groundMaterialProps));var m=this.groundCanvas.getContext("2d"),f=this.gridCanvas.getContext("2d");if(this.drawTexture(m,2048,20),f.fillStyle="#000000",f.fillRect(0,0,2048,2048),this.drawGrid(f,2048,20),this.groundTexture.needsUpdate=!0,this.gridTexture.needsUpdate=!0,e){var y=new THREE.Mesh(this.groundGeometry,this.groundMaterial);this.ground.setObject3D("mesh",y)}else this.ground.getObject3D("mesh").material=this.groundMaterial;this.ground.setAttribute("shadow",{cast:!1,receive:this.environmentData.shadow})},drawGrid:function(e,_,t){if("none"!=this.environmentData.grid){var n,i,r,o=Math.floor(t/2),s=_/(t/2);switch(e.fillStyle=this.environmentData.gridColor,this.environmentData.grid){case"1x1":case"2x2":for("1x1"==this.environmentData.grid&&(o*=2,s=_/t),n=0;n<o;n++)r=Math.floor(n*s),e.fillRect(0,r,_,1),e.fillRect(r,0,1,_);break;case"crosses":var a=Math.floor(s/20);for(n=0;n<o+1;n++)for(r=Math.floor(n*s),i=0;i<o+1;i++){var $=Math.floor(-a+i*s);e.fillRect($,r,2*a,1),e.fillRect(r,$,1,2*a)}break;case"dots":for(n=0;n<o+1;n++)for(i=0;i<o+1;i++)e.beginPath(),e.arc(Math.floor(i*s),Math.floor(n*s),4,0,2*Math.PI),e.fill();break;case"xlines":for(n=0;n<o;n++)e.fillRect(Math.floor(n*s),0,1,_);break;case"ylines":for(n=0;n<o;n++)e.fillRect(0,Math.floor(n*s),_,1)}}},drawTexture:function(e,_,n){if(e.fillStyle=this.environmentData.groundColor,e.fillRect(0,0,_,_),"none"!=this.environmentData.groundTexture)switch(this.environmentData.groundTexture){case"checkerboard":e.fillStyle=this.environmentData.groundColor2;var i,r,o,s,a,$,l,d=Math.floor(n/2),g=_/(n/2);for(i=0;i<d+1;i+=2)for(var h=0;h<d+1;h++)e.fillRect(Math.floor((i+h%2)*g),Math.floor(h*g),Math.floor(g),Math.floor(g));break;case"squares":var u=_/16;for(o=new THREE.Color(this.environmentData.groundColor),s=new THREE.Color(this.environmentData.groundColor2),i=0;i<256;i++)(r=this.random(i+3)>.5?o.clone():s.clone()).addScalar(.1*this.random(i+3)-.05),e.fillStyle="#"+r.getHexString(),e.fillRect(i%16*u,Math.floor(i/16)*u,u,u);break;case"noise":a=($=e.getImageData(0,0,_,_)).data,o=new THREE.Color(this.environmentData.groundColor),s=new THREE.Color(this.environmentData.groundColor2);var c=new THREE.Color(s.r-o.r,s.g-o.g,s.b-o.b),m=new t;for(i=0,h=0,l=a.length;i<l;i+=4,h++){var f=m.noise(h%_/_*3,h/_/_*3,0);a[i+0]=Math.floor(255*(o.r+c.r*f)),a[i+1]=Math.floor(255*(o.g+c.g*f)),a[i+2]=Math.floor(255*(o.b+c.b*f))}e.putImageData($,0,0);break;case"walkernoise":var y=Math.floor(_/2),p=document.createElement("canvas");p.width=y,p.height=y;var v=p.getContext("2d");v.fillStyle=this.environmentData.groundColor,v.fillRect(0,0,y,y),a=($=v.getImageData(0,0,y,y)).data,o=new THREE.Color(this.environmentData.groundColor),s=new THREE.Color(this.environmentData.groundColor2);var C=[];for(i=0;i<1e3;i++)r=o.clone().lerp(s,Math.random()),C.push({x:Math.random()*y,y:Math.random()*y,r:Math.floor(255*r.r),g:Math.floor(255*r.g),b:Math.floor(255*r.b)});for(var x=0;x<5e3;x++)for(i=0;i<1e3;i++){var D=C[i],S=4*Math.floor(D.y*y+D.x);a[S+0]=D.r,a[S+1]=D.g,a[S+2]=D.b,D.x+=Math.floor(3*Math.random())-1,D.y+=Math.floor(3*Math.random())-1,D.x>=y&&(D.x=D.x-y),D.y>=y&&(D.y=D.y-y),D.x<0&&(D.x=y+D.x),D.y<0&&(D.y=y+D.y)}v.putImageData($,0,0),e.drawImage(p,0,0,_,_)}},getAssetGeometry:function(e){function _(e,_){for(var t=(new THREE.Vector3,e.attributes.position.array),n=t.length,i=0;i<n;i+=3)t[i]=(o.random(i)-.5)*_,t[i+1]=(o.random(i+n)-.5)*_,t[i+2]=(o.random(i+2*n)-.5)*_;e.attributes.position.needsUpdate=!0}if(!e)return null;for(var t,n,i,r=[],o=this,s=0;s<e.length;s++)if("lathe"==e[s].type){var a=-99999,$=[];for(i=e[s].vertices,t=0;t<i.length;t+=2)$.push(new THREE.Vector2(i[t],i[t+1])),i[t+1]>a&&(a=i[t+1]);(n=new THREE.LatheGeometry($,e[s].segments||8)).applyMatrix4((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(-Math.PI,0,0))),n.applyMatrix4((new THREE.Matrix4).makeTranslation(0,a,0)),n=n.toNonIndexed(),r.push(n)}else if("extrude"==e[s].type){var l=new THREE.Shape;for(i=e[s].vertices,t=0;t<i.length;t+=2)0==t?l.moveTo(i[t],i[t+1]):l.lineTo(i[t],i[t+1]);(n=new THREE.ExtrudeGeometry(l,{amount:1,bevelEnabled:!1})).applyMatrix((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(-Math.PI/2,0,0))),e[s].noise&&_(n,e[s].noise),r.push(n)}else if("mesh"==e[s].type){n=new THREE.BufferGeometry,i=e[s].vertices;var d=e[s].faces,g=new Float32Array(i);if(n.setIndex(d),n.setAttribute("position",new THREE.BufferAttribute(g,3)),e[s].mirror){var h=n.clone();h.applyMatrix4((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(0,Math.PI,0))),n=THREE.BufferGeometryUtils.mergeBufferGeometries([n,h])}e[s].noise&&_(n,e[s].noise),(n=n.toNonIndexed()).computeVertexNormals(),r.push(n)}return r},updateDressing:function(){var e=new THREE.Object3D,_=[];if(this.dressing.setAttribute("visible","none"!=this.environmentData.dressing),"none"!=this.environmentData.dressing){switch(this.environmentData.dressing){case"cubes":(i=[new THREE.BoxGeometry(1,1,1)])[0].applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));break;case"pyramids":(i=[new THREE.ConeGeometry(1,1,4,1,!0)])[0].applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));break;case"cylinders":(i=[new THREE.CylinderGeometry(.5,.5,1,8,1,!0)])[0].applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));break;default:if(!(i=this.getAssetGeometry(this.assets[this.environmentData.dressing])))return}for(var t=0,n=88343;t<this.environmentData.dressingAmount;t++,n++){var i,r,o=(i[Math.floor(this.random(33+t)*i.length)].clone,i[Math.floor(this.random(33+t)*i.length)].clone()),s=this.environmentData.dressingScale,a=new THREE.Vector3(this.environmentData.dressingVariance.x,this.environmentData.dressingVariance.y,this.environmentData.dressingVariance.z);r=this.random(n)<this.environmentData.dressingOnPlayArea?this.STAGE_SIZE/12*this.random(n+1):this.STAGE_SIZE/20+Math.max(a.x,a.z)+this.STAGE_SIZE/20*this.random(n+1)+this.random(n+2)*this.STAGE_SIZE/5;var $=this.random(n+3)*Math.PI*2,l=new THREE.Matrix4,d=this.random(n+4),g=this.environmentData.dressingUniformScale;l.compose(new THREE.Vector3(Math.cos($)*r,0,Math.sin($)*r),(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),(this.random(n+5)-.5)*a.length()*Math.PI*2),new THREE.Vector3(s+(g?d:this.random(n+6))*a.x,s+(g?d:this.random(n+7))*a.y,s+(g?d:this.random(n+8))*a.z)),o.applyMatrix4(l),_.push(o)}var h=THREE.BufferGeometryUtils.mergeBufferGeometries(_);h.attributes.position.needsUpdate=!0;var u=new THREE.MeshLambertMaterial({color:new THREE.Color(this.environmentData.dressingColor)}),c=new THREE.Mesh(h,u);e.add(c),this.dressing.setObject3D("mesh",e),this.dressing.setAttribute("shadow","cast",this.environmentData.shadowDressing)}},createStars:function(e=0){for(var _=this.data.stars,t=new THREE.BufferGeometry,n=new Float32Array(3*_),i=this.STAGE_SIZE-1,r=new THREE.Vector3,o=0;o<n.length;o+=3)r.set(this.random(o+23)-.5,this.random(o+24)-e,this.random(o+25)-.5),r.normalize(),r.multiplyScalar(i),n[o]=r.x,n[o+1]=r.y,n[o+2]=r.z;t.setAttribute("position",new THREE.BufferAttribute(n,3)),t.setDrawRange(0,0);var s=new THREE.PointsMaterial({size:.01,color:13421772,fog:!1});this.stars.setObject3D("mesh",new THREE.Points(t,s))},setStars:function(e,_){this.stars||(this.stars=document.createElement("a-entity"),this.stars.classList.add("environment"),this.stars.id="stars",this.createStars(_),this.el.components.econtrol.stars=this.stars,this.el.appendChild(this.stars)),e=Math.floor(Math.min(this.data.stars,Math.max(0,e))),this.stars.getObject3D("mesh").geometry.setDrawRange(0,e)}}),AFRAME.registerShader("skyshader",{schema:{luminance:{type:"number",default:1,min:0,max:2,is:"uniform"},turbidity:{type:"number",default:2,min:0,max:20,is:"uniform"},reileigh:{type:"number",default:1,min:0,max:4,is:"uniform"},mieCoefficient:{type:"number",default:.005,min:0,max:.1,is:"uniform"},mieDirectionalG:{type:"number",default:.8,min:0,max:1,is:"uniform"},sunPosition:{type:"vec3",default:{x:0,y:0,z:-1},is:"uniform"},color:{type:"color",default:"#fff"}},vertexShader:"varying vec3 vWorldPosition;\nvoid main() {\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D skySampler;\nuniform vec3 sunPosition;\nvarying vec3 vWorldPosition;\nvec3 cameraPos = vec3(0., 0., 0.);\nuniform float luminance;\nuniform float turbidity;\nuniform float reileigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\nconst float e = 2.71828182845904523536028747135266249775724709369995957;\nconst float pi = 3.141592653589793238462643383279502884197169;\nconst float n = 1.0003;\nconst float N = 2.545E25;\nconst float pn = 0.035;\nconst vec3 lambda = vec3(680E-9, 550E-9, 450E-9);\nconst vec3 K = vec3(0.686, 0.678, 0.666);\nconst float v = 4.0;\nconst float rayleighZenithLength = 8.4E3;\nconst float mieZenithLength = 1.25E3;\nconst vec3 up = vec3(0.0, 1.0, 0.0);\nconst float EE = 1000.0;\nconst float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\nconst float cutoffAngle = pi/1.95;\nconst float steepness = 1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));\n}\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005 / vec3(94, 40, 18);\n}\nfloat rayleighPhase(float cosTheta)\n{   \nreturn (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));\n}\nvec3 totalMie(vec3 lambda, vec3 K, float T)\n{\nfloat c = (0.2 * T ) * 10E-18;\nreturn 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;\n}\nfloat hgPhase(float cosTheta, float g)\n{\nreturn (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));\n}\n// Filmic ToneMapping http://filmicgames.com/archives/75\nfloat A = 0.15;\nfloat B = 0.50;\nfloat C = 0.10;\nfloat D = 0.20;\nfloat E = 0.02;\nfloat F = 0.30;\nfloat W = 1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\n}\nvoid main() \n{\nfloat sunfade = 1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\nfloat reileighCoefficient = reileigh - (1.0* (1.0-sunfade));\nvec3 sunDirection = normalize(sunPosition);\nfloat sunE = sunIntensity(dot(sunDirection, up));\nvec3 betaR = simplifiedRayleigh() * reileighCoefficient;\nvec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;\nfloat zenithAngle = acos(max(0.0, dot(up, normalize(vWorldPosition - cameraPos))));\nfloat sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));\nfloat sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));\nvec3 Fex = exp(-(betaR * sR + betaM * sM));\nfloat cosTheta = dot(normalize(vWorldPosition - cameraPos), sunDirection);\nfloat rPhase = rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta = betaR * rPhase;\nfloat mPhase = hgPhase(cosTheta, mieDirectionalG);\nvec3 betaMTheta = betaM * mPhase;\nvec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));\nLin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up, sunDirection),5.0),0.0,1.0));\nvec3 direction = normalize(vWorldPosition - cameraPos);\nfloat theta = acos(direction.y); // elevation --> y-axis, [-pi/2, pi/2]\nfloat phi = atan(direction.z, direction.x); // azimuth --> x-axis [-pi/2, pi/2]\nvec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);\nvec3 L0 = vec3(0.1) * Fex;\nfloat sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\nL0 += (sunE * 19000.0 * Fex)*sundisk;\nvec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor = (Lin+L0);   \ntexColor *= 0.04 ;\ntexColor += vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance = 1.0;\nfloat fLumScaled = 0.1 / luminance;     \nfloat fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); \nfloat ExposureBias = fLumCompressed;\nvec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\nvec3 color = curr*whiteScale;\nvec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));\ngl_FragColor.rgb = retColor;\ngl_FragColor.a = 1.0;\n}"}),AFRAME.registerShader("gradientshader",{schema:{topColor:{type:"color",default:"1 0 0",is:"uniform"},bottomColor:{type:"color",default:"0 0 1",is:"uniform"}},vertexShader:"varying vec3 vWorldPosition;\nvoid main() {\n vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n vWorldPosition = worldPosition.xyz;\n gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n}",fragmentShader:"uniform vec3 bottomColor;\nuniform vec3 topColor;\nuniform float offset;\nvarying vec3 vWorldPosition;\nvoid main() {\n float h = normalize( vWorldPosition ).y;\n gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max(h, 0.0 ), 0.8 ), 0.0 ) ), 1.0 );\n}"});var t=function(e){var _,t;for(this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[],t=0;t<256;t++)_=parseFloat("0."+Math.sin(9999*e*t).toString().substr(7)),this.p[t]=Math.floor(256*_);for(this.perm=[],t=0;t<512;t++)this.perm[t]=this.p[255&t]};t.prototype.dot=function(e,_,t,n){return e[0]*_+e[1]*t+e[2]*n},t.prototype.mix=function(e,_,t){return(1-t)*e+t*_},t.prototype.fade=function(e){return e*e*e*(e*(6*e-15)+10)},t.prototype.noise=function(e,_,t){var n=Math.floor(e),i=Math.floor(_),r=Math.floor(t);e-=n,_-=i,t-=r,n&=255,i&=255,r&=255;var o=this.perm[n+this.perm[i+this.perm[r]]]%12,s=this.perm[n+this.perm[i+this.perm[r+1]]]%12,a=this.perm[n+this.perm[i+1+this.perm[r]]]%12,$=this.perm[n+this.perm[i+1+this.perm[r+1]]]%12,l=this.perm[n+1+this.perm[i+this.perm[r]]]%12,d=this.perm[n+1+this.perm[i+this.perm[r+1]]]%12,g=this.perm[n+1+this.perm[i+1+this.perm[r]]]%12,h=this.perm[n+1+this.perm[i+1+this.perm[r+1]]]%12,u=this.dot(this.grad3[o],e,_,t),c=this.dot(this.grad3[l],e-1,_,t),m=this.dot(this.grad3[a],e,_-1,t),f=this.dot(this.grad3[g],e-1,_-1,t),y=this.dot(this.grad3[s],e,_,t-1),p=this.dot(this.grad3[d],e-1,_,t-1),v=this.dot(this.grad3[$],e,_-1,t-1),C=this.dot(this.grad3[h],e-1,_-1,t-1),x=this.fade(e),D=this.fade(_),S=this.fade(t),w=this.mix(u,c,x),b=this.mix(y,p,x),A=this.mix(m,f,x),k=this.mix(v,C,x),z=this.mix(w,A,D),T=this.mix(b,k,D);return this.mix(z,T,S)}}]);